<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CheckList de Peças</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --background: #000000;
            --surface: #111111;
            --surface-hover: #1a1a1a;
            --primary: #00DC82;
            --primary-dark: #00b368;
            --text: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --border: rgba(255, 255, 255, 0.1);
            --success: #00DC82;
            --warning: #FFD600;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding: 2rem 0;
            border-bottom: 1px solid var(--border);
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: -1px;
            color: var(--text);
            position: relative;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--primary);
            border-radius: 2px;
        }

        .logo {
            max-width: 150px;
            height: auto;
        }

        .piece-management {
            margin-bottom: 1rem;
        }

        .piece-management button {
            background: var(--primary);
            color: var(--background);
            border: none;
        }

        .piece-management button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 220, 130, 0.2);
        }

        .search-piece-form {
            margin-bottom: 1rem;
        }

        .search-piece-form input {
            width: 100%;
            background: var(--surface-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-piece-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 220, 130, 0.1);
        }

        .search-piece-form input::placeholder {
            color: var(--text-secondary);
        }

        .no-results {
            text-align: center;
            padding: 1rem;
            color: var(--text-secondary);
        }

        .vehicle-info {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .input-group label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .input-group input {
            background: var(--surface-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-group input[type="number"] {
            width: 100%;
            min-width: 150px;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 220, 130, 0.1);
        }

        .input-group input::placeholder {
            color: var(--text-secondary);
        }

        .checklist-container {
            background: var(--surface);
            border-radius: 24px;
            overflow: hidden;
            margin-bottom: 3rem;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        th, td {
            padding: 1.5rem 2rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.75rem;
        }

        td {
            font-size: 0.95rem;
        }

        tr:hover {
            background: var(--surface-hover);
        }

        .button-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 3rem;
        }

        button, .button {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            color: var(--background);
            background: var(--text);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        button.primary, .button.primary {
            background: var(--primary);
            color: var(--background);
        }

        button.secondary, .button.secondary {
            background: var(--primary);
            color: var(--background);
            border: none;
        }

        button:hover, .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 220, 130, 0.2);
        }

        button.secondary:hover {
            background: var(--primary-dark);
            box-shadow: 0 8px 30px rgba(0, 220, 130, 0.2);
        }

        select {
    width: 100%;
    min-width: 120px;
    padding: 0.75rem 0.5rem;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--surface);
    color: var(--text);
    font-size: 0.9rem;
    transition: all 0.3s ease;
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='white' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.5rem center;
    padding-right: 2rem;
}

        select:hover {
            border-color: var(--primary);
        }

        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 220, 130, 0.1);
        }

        .status-possui {
            color: var(--success);
        }

        .status-nao-possui {
            color: #FF3B30;
        }
        #relatorio {
            background: var(--surface);
            border-radius: 24px;
            padding: 2rem;
            margin-top: 3rem;
            border: 1px solid var(--border);
            animation: slideUp 0.6s ease-out forwards;
        }

        #relatorio h2 {
            color: var(--text);
            margin-bottom: 2rem;
            font-size: 2rem;
            letter-spacing: -0.5px;
        }

        #relatorio ul {
            list-style: none;
            display: grid;
            gap: 1rem;
        }

        #relatorio li {
            padding: 1.5rem;
            background: var(--surface-hover);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        #relatorio li:hover {
            transform: translateX(8px);
        }

        #relatorio li strong {
            color: var(--primary);
            font-weight: 600;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
            transform-origin: 0 50%;
            transform: scaleX(0);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            background: var(--surface);
            margin: 5% auto;
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            border-radius: 16px;
            border: 1px solid var(--border);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .close-button {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .add-piece-form {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .add-piece-form input {
            flex: 1;
            background: var(--surface-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text);
            font-size: 1rem;
        }

        .piece-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .piece-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--surface-hover);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .piece-item button {
            padding: 0.5rem 1rem;
            background: #FF3B30;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .piece-item button:hover {
            background: #ff1f1f;
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 2rem;
            background: var(--primary);
            color: var(--background);
            border-radius: 12px;
            font-weight: 500;
            animation: slideIn 0.3s ease-out forwards;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            .header {
                flex-direction: column;
                gap: 2rem;
                text-align: center;
                padding: 2rem 1rem;
            }
            h1 {
                font-size: 2rem;
            }
            h1::after {
                left: 50%;
                transform: translateX(-50%);
            }
            .button-container {
                grid-template-columns: 1fr;
            }
            th, td {
                padding: 1rem;
            }
            .vehicle-info {
                grid-template-columns: 1fr;
            }
            select {
        font-size: 0.85rem;
        padding: 0.5rem 1.5rem 0.5rem 0.5rem;
    }

    td {
        padding: 0.75rem 0.5rem;
    }

    table td:last-child {
        min-width: 110px;
        width: 40%;
    }

    table td:first-child {
        width: 60%;
    }
}
        
        

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .slide-up {
            animation: slideUp 0.6s ease-out forwards;
        }

        tr {
    animation: none;
    opacity: 1;
}

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
        .scroll-button {
    position: fixed;
    right: 2rem;
    padding: 1rem;
    background: var(--primary);
    color: var(--background);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 50px;
    height: 50px;
    box-shadow: 0 4px 12px rgba(0, 220, 130, 0.2);
    z-index: 1000;
}

.scroll-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(0, 220, 130, 0.3);
}

.scroll-top {
    bottom: 7rem;
    opacity: 0;
    visibility: hidden;
}

.scroll-bottom {
    bottom: 2rem;
}

.scroll-button.visible {
    opacity: 1;
    visibility: visible;
}

/* Arrow icons */
.scroll-button::before {
    content: '';
    width: 12px;
    height: 12px;
    border-left: 3px solid var(--background);
    border-bottom: 3px solid var(--background);
    transform: rotate(135deg); /* Points up */
}

.scroll-bottom::before {
    transform: rotate(-45deg); /* Points down */
}
.search-container {
    background: var(--surface);
    padding: 1.5rem;
    border-radius: 12px;
    margin-bottom: 1rem;
    border: 1px solid var(--border);
    
}

.highlight-row {
    background: rgba(0, 220, 130, 0.2) !important;
    transition: background-color 0.3s ease;
}

/* Ajuste no estilo da tabela para scroll suave */
.checklist-container {
    background: var(--surface);
    border-radius: 24px;
    overflow: hidden;
    margin-bottom: 3rem;
    border: 1px solid var(--border);
    animation: fadeIn 0.3s ease-out forwards;
}
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.search-results {
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
   
}
    </style>
</head>
<body>
    <button id="scrollTop" class="scroll-button scroll-top" aria-label="Scroll to top"></button>
<button id="scrollBottom" class="scroll-button scroll-bottom" aria-label="Scroll to bottom"></button>

    <div class="progress-bar"></div>
    <div class="container">
        <div class="header">
            <h1>Checklist de Peças</h1>
            <img src="LOGO FUNDO TRANSPARENTE.png" alt="Logo Skina Ecopeças" class="logo">
        </div>

        <div class="piece-management fade-in">
            <button onclick="showPieceModal()" class="secondary">Gerenciar Peças</button>
        </div>

        <div class="vehicle-info fade-in">
            <div class="input-group">
                <label for="vehicle-name">Nome do Veículo</label>
                <input type="text" id="vehicle-name" placeholder="Ex: Fiat Uno" required>
            </div>
            <div class="input-group">
                <label for="vehicle-year">Ano do Veículo</label>
                <input type="number" id="vehicle-year" placeholder="Ex: 2020" min="1900" max="2025" required>
            </div>
        </div>
        <div class="search-container fade-in">
            <div class="input-group">
                <label for="search-checklist">Pesquisar Peça</label>
                <input 
                    type="text" 
                    id="search-checklist" 
                    placeholder="Digite o nome da peça..." 
                    onkeyup="searchAndHighlight()"
                >
            </div>
            <div id="search-results" class="search-results"></div>
        </div>
        

        <div class="checklist-container slide-up">
            <table>
                <thead>
                    <tr>
                        <th>Peças</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="checklist-body">
                </tbody>
            </table>
        </div>

        <div class="button-container fade-in">
            <button onclick="gerarRelatorio()" class="primary">Gerar Relatório</button>
            <button onclick="baixarRelatorio('pdf')" class="primary">Download PDF</button>
            <button onclick="exportarSelecoes()" class="secondary">Salvar Seleções</button>
            <label for="importar" class="button primary">
                Importar Seleções
                <input type="file" id="importar" accept=".json" style="display: none;" onchange="importarSelecoes(this)">
            </label>
        </div>

        <div id="relatorio"></div>
    </div>

    <div id="pieceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gerenciar Peças</h2>
                <button onclick="closePieceModal()" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <div class="search-piece-form">
                    <input type="text" id="searchPiece" placeholder="Pesquisar peça..." onkeyup="filterPieces()">
                </div>
                <div class="add-piece-form">
                    <input type="text" id="newPieceName" placeholder="Nome da nova peça">
                    <button onclick="addNewPiece()" class="primary">Adicionar Peça</button>
                </div>
                <div class="piece-list" id="piecesList">
                </div>
            </div>
        </div>
    </div>

    <script>

        // Variable to track if there are unsaved changes
let hasUnsavedChanges = false;

// Function to set unsaved changes flag
function setUnsavedChanges() {
    hasUnsavedChanges = true;
}

// Function to clear unsaved changes flag
function clearUnsavedChanges() {
    hasUnsavedChanges = false;
}

// Add event listeners to track changes
document.getElementById('vehicle-name').addEventListener('input', setUnsavedChanges);
document.getElementById('vehicle-year').addEventListener('input', setUnsavedChanges);
document.getElementById('checklist-body').addEventListener('change', setUnsavedChanges);

// Clear unsaved changes when saving
document.querySelector('button[onclick="exportarSelecoes()"]').addEventListener('click', clearUnsavedChanges);

// Add beforeunload event listener
window.addEventListener('beforeunload', function(e) {
    if (hasUnsavedChanges) {
        // Standard message (browsers may show their own message instead)
        const message = 'Você tem alterações não salvas. Deseja realmente sair da página?';
        e.returnValue = message; // Standard
        return message; // For older browsers
    }
});
        const pecas = [
            'capô',
'Farol Direito',
'Farol Esquerdo',
'Lanterna Direita',
'Lanterna Esquerda',
'Parachoque Dianteiro',
'Parachoque Traseiro',
'Grade',
'Painel Frontal',
'Radiador',
'Radiador Cambio',
'Condensador',
'Ventoinha',
'Sensores',
'fechadura capô',
'Acabamento painel Frontal',
'paralama Direito',
'Paralama Esquerdo',
'Acabamento Paralama Direito',
'Acabamento Paralama Esquerdo',
'Acabamento Paralama Tras Direito',
'Acabamento Paralama Tras Esquerdo',
'Parabarro Direito',
'Parabarro Esquerdo',
'Rodas',
'Pneus',
'Chicote Motor',
'Chicote Carroceria frontal',
'Mangueira Inferior Radiador',
'Mangueira Superior Radiador',
'Intercooler',
'Amortecedor Dianteiro Direito',
'Amortecedor Dianteiro Esquerdo',
'Amortecedor Traseiro Direito',
'Amortecedor Trasiero Esquerdo',
'Molas Dianteiras',
'Molas traseiras',
'Eixo Traseiro',
'Tambor de Freio Direito',
'Tambor de Freio Esquerdo',
'Manga de Eixo Direita',
'Manga de Eixo Esquerda',
'Pinça de Freio Dianteira Direita',
'Pinça de Freio Dianteira Esquerda',
'Pinça De Freio Traseira Direita',
'Pinça de Freio Traseira Esquerda',
'Semi Eixo Dianteiro Direito',
'Semi Eixo Dianteiro Esquerdo',
'Semi Eixo Traseiro Direito',
'Semi Eixo Traseiro Esquerdo',
'Diferencial Dianteiro',
'Diferencial Traseiro',
'Cambio',
'Seletora Cambio',
'Modulo Cambio',
'Agregado Dianteiro',
'Agregado Traseiro',
'Balança Dianteira Direita',
'Balança Dianteira Esquerda',
'Balança Traseira Direita',
'Balança Traseira Esquerda',
'Barra estabilizadora',
'Bieletas',
'Disco de Freio',
'Coxim Inferior',
'Coxim Cambio',
'Coxim Motor',
'Catalizador',
'Coletor Escape',
'Coletor Admissão',
'Turbina',
'Mangueira Turbina',
'Caixa Filtro de Ar',
'Duto Caixa Filtro Ar',
'Sensor de fluxo',
'Sonda Lambda',
'Sensor de oxigenio',
'Silenciador Escapamento',
'Bateria',
'Polo Bateria',
'Suporte Bateria',
'Bobina',
'Vela Ignição',
'Flauta',
'Bico',
'Mangueira Combustível Flauta',
'Tbi',
'Mangueira Filtro Ar',
'Alternador',
'Motor Partida',
'Compressor Ar Condicionado',
'Bomba de Alta',
'Bomba de Vacuo',
'Bomba Direção hidraulica',
'Bomba Combustivel',
'Bomba Agua',
'Bomba de Oleo Motor',
'Modulo Abs',
'Carcaça Valvula',
'Valvula EGR',
'Polia',
'Tensor',
'Trocador de Calor',
'Tampa Motor',
'Caixa Direção',
'Mangueira Direção Hidraulica',
'Mangueira Ar Condicionado',
'Mangueira Trocador de Calor',
'Pressostato',
'Coluna Direção',
'Volante',
'hidrovácuo',
'Cilindro Mestre Freio',
'Reservatório Freio',
'Reservatório Direção Hidráulica',
'Reservatório Agua Radiador',
'Reservatório Agua Parabrisa',
'Reservatório de Arla',
'Reservatório de Combustivel',
'Mangueira Esguicho',
'Braço Limpador Direito',
'Braço Limpador Esquerdo',
'Motor Esguicho',
'Motor Limpador Parabrisa',
'Motor Limpador Traseiro',
'Motor Maquina de Vidro',
'Motor Trava',
'Motor Parcial',
'Volante Motor',
'Embreagem',
'Conversor de Torque',
'Travessa do Motor',
'Buzina',
'Alarme/Sirene',
'Portinhola',
'Porta Dianteira Direita',
'Porta Dianteira Esquerda',
'Porta Traseira Direita',
'Porta Traseira Esquerda',
'Tampa Traseira',
'Tampa Reservatório',
'Tampa de Combustivel',
'Gargalo tanque',
'Tanque Combustivel',
'Cinta Tanque Combusivel',
'Mangueira Linha Combustivel',
'Canister',
'Valvula Canister',
'Braço Suspensão Traseiro Direito',
'Braço Suspensão Traseiro Esquerdo',
'Cardan',
'Forro de Porta Dianteiro Esquerdo',
'Forro de Porta Dianteiro Direito',
'Forro de Porta Traseiro Direito',
'Forro de Porta Traseiro Esquerdo',
'Fechadura de Porta Dint Esquerdo',
'Fechadura de Porta Diant Direita',
'Fechadura de Porta Tras Direita',
'Fechadura de Porta Tras Esquerda',
'Fechadura Porta Mala',
'Maquina de Vidro Diant Esquerda',
'Maquina de Vidro Diant Direita',
'Maquina de Vidro Tras Direita',
'Maquina de Vidro Tras Esquerda',
'Acabamento Ext Coluna Porta Diant Esquerda',
'Acabamento Ext Coluna Porta Diant Direita',
'Acabamento Ext Porta tras Direita',
'Acabamento Ext Porta Tras Esquerda',
'Vidros',
'Dobradiças',
'Limitador Dianteiro',
'Limitador Traseiro',
'Comando Vidro Diant Esquerdo',
'Comando Vidro Diant Direito',
'Comando Vidro Traseiro Direito',
'Comando Vidro Traseiro Esquerdo',
'Auto Falante',
'Maçaneta Interna',
'maçaneta Externa',
'Puxador Forro Porta Daint Esquerdo',
'Puxador Forro Porta Diant Direito',
'Puxador Forro Porta Tras Direito',
'Puxador Forro Porta Tras Esquerdo',
'Painel Tabelier',
'Painel Instrumento',
'Porta Luva',
'Difusor de Ar Esquerdo',
'Difusor de Ar Meio',
'Difusor de Ar Direito',
'Retrovisor Esquerdo',
'Retrovisor Direito',
'Retrovisor Para-brisa',
'Acabamento do Volante',
'Acabamento Inferior Volante (painel)',
'Tampa Caixa de Fusível Interna',
'Tampa Caixa de Fusível Motor',
'Acabamento central do Painel',
'Acabamento Multimidia',
'Multimidia',
'Radio/som',
'Porta Copo/Objeto Painel',
'Kit Airbag',
'caixa evaporadora',
'Ventilador Caixa Evaporadora',
'Pedal acelerador',
'Pedal Freio',
'Pedal embreagem',
'Atuador embreagem',
'Modulo tração',
'modulo BCM',
'Modulo BCI',
'Modulo Injeção',
'Caixa de Fusível',
'Modulo Conforto',
'Modulo Vidro',
'Módulos Extras',
'Jogo de Tapete',
'Carpete',
'Jogo Banco',
'Acabamento Coluna Parabrisa',
'Acabamento Inferior Coluna Meio',
'Acabamento Superior Coluna Meio',
'Acabamento Soleira Diant Esquerda',
'Acabamento Soleira Diant Direita',
'Acabamento Soleira Tras Esquerda',
'Acabamento Soleira Tras Direita',
'Acabamento Coluna Tras Esquerda',
'Acabamento Coluna Tras Direita',
'Suporte Tampão Direito',
'Suporte Tampão Esquerdo',
'Forro de Teto',
'Porta Oculos',
'Alça Segurança',
'Quebra Sol Direito',
'Quebra Sol Esquerdo',
'Luz de Teto',
'Teto Solar',
'Luz Cortezia',
'Chave de Farol',
'Chave de Seta',
'Ignição',
'Chave reserva',
'Manual carro',
'Computador de Bordo',
'Console Central',
'Trambulador',
'Alavanca de Marcha',
'Comando Ar Condicionado',
'Apoio de Braço',
'Tampão',
'Tampão Estepe',
'Estepe',
'Macaco',
'Chave de Roda',
'Amortecedor Porta Mala',
'Ganchos Porta Mala',
'Borracha Porta Dianteira Esquerda',
'Borracha Porta Dianteira Direita',
'Borracha Porta Traseira Direita',
'Borracha Porta Traseira Esquerda',
'Jogo Friso Externo de Porta',
'Canaleta Porta Diant Direita',
'Canaleta Porta Diant Esquerda',
'Canaleta Porta Tras Direita',
'Canaleta Porta Tras Esquerda',
'Pestana Porta Diant Direita',
'Pestana Porta Diant Esquerda',
'Pestana Porta Tras Direita',
'Pestana Porta Tras Esquerda',
'Spoiler Lateral Direito',
'Spoiler Lateral Esquerdo',
'Spoiler Dianteiro',
'Spoiler Traseiro',
'Defletor Parachoque Dianteiro',
'Defletor Parabarro',
'Sensor de Estacionamento',
'Over bump',
'Camera Estacionametno',
'Modulo Estacionamento',
'Rack de Teto',
'Santo Antonio',
'Capota Maritima',
'Engate',
'Estribos Laterais',

        ];

let customPecas = new Set(pecas);
const progressBar = document.querySelector('.progress-bar');
let totalItems = pecas.length;
let completedItems = 0;

function updateProgress() {
    const progress = (completedItems / totalItems) * 100;
    progressBar.style.transform = `scaleX(${progress / 100})`;
}

function showToast(message) {
    const toast = document.createElement('div');
    toast.classList.add('toast');
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

function showPieceModal() {
    const modal = document.getElementById('pieceModal');
    modal.style.display = 'block';
    updatePiecesList();
}

function closePieceModal() {
    const modal = document.getElementById('pieceModal');
    modal.style.display = 'none';
}

function filterPieces() {
    const searchInput = document.getElementById('searchPiece');
    const filter = searchInput.value.toLowerCase();
    const piecesList = document.getElementById('piecesList');
    const pieces = Array.from(customPecas).sort();
    
    piecesList.innerHTML = '';
    
    const filteredPieces = pieces.filter(peca => 
        peca.toLowerCase().includes(filter)
    );
    
    if (filteredPieces.length === 0) {
        piecesList.innerHTML = '<div class="no-results">Nenhuma peça encontrada</div>';
        return;
    }
    
    filteredPieces.forEach(peca => {
        const pieceItem = document.createElement('div');
        pieceItem.className = 'piece-item';
        pieceItem.innerHTML = `
            <span>${peca}</span>
            <button onclick="removePiece('${peca}')" class="remove-button">Remover</button>
        `;
        piecesList.appendChild(pieceItem);
    });
}

function updatePiecesList() {
    const searchInput = document.getElementById('searchPiece');
    if (searchInput) {
        searchInput.value = '';
    }
    filterPieces();
}

function addNewPiece() {
    const input = document.getElementById('newPieceName');
    const newPiece = input.value.trim();
    
    if (newPiece) {
        if (customPecas.has(newPiece)) {
            showToast('Esta peça já existe na lista!');
            return;
        }
        
        customPecas.add(newPiece);
        updatePiecesList();
        updateChecklistTable();
        input.value = '';
        showToast('Peça adicionada com sucesso!');
    }
}

function removePiece(peca) {
    customPecas.delete(peca);
    updatePiecesList();
    updateChecklistTable();
    showToast('Peça removida com sucesso!');
}

function updateChecklistTable() {
    const checklistBody = document.getElementById('checklist-body');
    const fragment = document.createDocumentFragment();
    
    totalItems = customPecas.size;
    completedItems = 0;

    const pecasOrdenadas = Array.from(customPecas).sort();
    
    pecasOrdenadas.forEach(peca => {
        const row = document.createElement('tr');
        
        const pecaCell = document.createElement('td');
        pecaCell.textContent = peca;
        
        const possuiCell = document.createElement('td');
        const select = document.createElement('select');
        
        const optionNao = document.createElement('option');
        optionNao.value = 'Nao';
        optionNao.textContent = 'Não Possui';
        
        const optionSim = document.createElement('option');
        optionSim.value = 'Sim';
        optionSim.textContent = 'Possui';
        
        select.appendChild(optionNao);
        select.appendChild(optionSim);

        let isChanging = false; // Flag para controlar o evento

        select.addEventListener('change', function() {
            if (isChanging) return; // Se já está processando uma mudança, retorna
            isChanging = true; // Marca que está processando

            if (this.value === 'Sim') {
                const observacao = prompt(`Insira uma observação para ${peca}:`);
                this.setAttribute('data-observacao', observacao || 'Sem observação');
                this.classList.add('status-possui');
                this.classList.remove('status-nao-possui');
                completedItems++;
            } else {
                this.removeAttribute('data-observacao');
                this.classList.add('status-nao-possui');
                this.classList.remove('status-possui');
                completedItems = Math.max(0, completedItems - 1);
            }
            updateProgress();
            setUnsavedChanges();
            isChanging = false; // Marca que terminou o processamento
        });

        select.classList.add('status-nao-possui');
        possuiCell.appendChild(select);
        row.appendChild(pecaCell);
        row.appendChild(possuiCell);
        fragment.appendChild(row);
    });
    
    checklistBody.innerHTML = '';
    checklistBody.appendChild(fragment);
    
    updateProgress();
}

function baixarRelatorio(tipo) {
    if (tipo === 'pdf') {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Carregar a logo
        const logo = new Image();
        logo.src = 'LOGO FUNDO TRANSPARENTE.png';

        logo.onload = function() {
            // Configurações de estilo
            const cores = {
                primaria: [0, 220, 130],    // Verde (#00DC82)
                secundaria: [17, 17, 17],    // Cinza escuro (#111111)
                texto: [51, 51, 51],         // Cinza para texto
                sucesso: [0, 220, 130],      // Verde
                erro: [255, 59, 48]          // Vermelho
            };

            // Função para desenhar retângulo com bordas arredondadas
            function roundedRect(x, y, w, h, r, cor) {
                doc.setFillColor(cor[0], cor[1], cor[2]);
                doc.roundedRect(x, y, w, h, r, r, 'F');
            }

            // Função para criar cabeçalho
            function addHeader(pageNumber) {
                // Fundo do cabeçalho
                roundedRect(0, 0, doc.internal.pageSize.width, 40, 0, cores.secundaria);
                
                // Adicionar a logo
                doc.addImage(logo, 'PNG', 10, 5, 30, 30);

                // Título
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(20);
                doc.setTextColor(255, 255, 255);
                doc.text('Checklist de Peças', 45, 23);

                // Data e página
                doc.setFontSize(9);
                doc.setTextColor(180, 180, 180);
                const dataAtual = new Date().toLocaleDateString('pt-BR');
                doc.text(`Data: ${dataAtual} | Página ${pageNumber}`, 
                    doc.internal.pageSize.width - 20, 23, { align: 'right' });
            }

            // Função para criar rodapé
            function addFooter() {
                const footerHeight = 20;
                const pageBottom = doc.internal.pageSize.height;
                
                // Linha superior do rodapé
                doc.setDrawColor(230, 230, 230);
                doc.line(10, pageBottom - footerHeight, 
                    doc.internal.pageSize.width - 10, pageBottom - footerHeight);

                // Texto do rodapé
                doc.setFontSize(8);
                doc.setTextColor(150, 150, 150);
                doc.text('Skina Ecopeças - Relatório gerado automaticamente', 10, 
                    pageBottom - 10);
            }

            // Função para adicionar seção
            function addSection(title, y, cor = cores.primaria) {
                doc.setFillColor(cor[0], cor[1], cor[2]);
                doc.roundedRect(10, y, doc.internal.pageSize.width - 20, 7, 2, 2, 'F');
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(12);  // Aumentei o tamanho da fonte
                doc.setTextColor(255, 255, 255);
                doc.text(title, 15, y + 5);
                return y + 12;
            }

            // Início da geração do PDF
            let pageNumber = 1;
            let yPos = 45;
            addHeader(pageNumber);

            // Informações do veículo
            const vehicleName = document.getElementById('vehicle-name').value || 'Não informado';
            const vehicleYear = document.getElementById('vehicle-year').value || 'Não informado';

            roundedRect(10, yPos, doc.internal.pageSize.width - 20, 25, 3, [245, 245, 245]);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.setTextColor(...cores.texto);
            doc.text('Informações do Veículo', 15, yPos + 7);
            doc.setFont('helvetica', 'bold'); // Mantém negrito
            doc.setFontSize(11);
            doc.text(`Modelo: ${vehicleName}`, 15, yPos + 17);
            doc.text(`Ano: ${vehicleYear}`, 100, yPos + 17);

            yPos += 35;

            // Lista de peças
            yPos = addSection('Peças Disponíveis', yPos, cores.sucesso);

            doc.setFont('helvetica', 'bold'); // Sempre negrito
            doc.setFontSize(11); // Fonte maior

            const rows = document.querySelectorAll('#checklist-body tr');
            rows.forEach(row => {
                const peca = row.cells[0].textContent;
                const select = row.cells[1].querySelector('select');
                const possui = select.value === 'Sim';
                const observacao = select.getAttribute('data-observacao');

                if (possui) {
                    if (yPos > doc.internal.pageSize.height - 40) {
                        addFooter();
                        doc.addPage();
                        pageNumber++;
                        yPos = 45;
                        addHeader(pageNumber);
                    }

                    roundedRect(15, yPos, doc.internal.pageSize.width - 30, 12, 2, [250, 250, 250]);
                    doc.setTextColor(...cores.texto);
                    doc.text(`• ${peca}`, 20, yPos + 8);
                    
                    if (observacao) {
                        yPos += 12;
                        doc.setTextColor(130, 130, 130);
                        doc.setFontSize(9); // Fonte menor para observação
                        doc.setFont('helvetica', 'bold'); // Mantém negrito mesmo na observação
                        doc.text(`Observação: ${observacao}`, 25, yPos + 8);
                        doc.setFontSize(11); // Volta ao tamanho normal
                    }

                    yPos += 15;
                }
            });

            // Peças faltantes
            yPos = addSection('Peças Indisponíveis', yPos, cores.erro);

            doc.setFont('helvetica', 'bold'); // Mantém negrito
            doc.setFontSize(11); // Mantém fonte maior

            rows.forEach(row => {
                const peca = row.cells[0].textContent;
                const select = row.cells[1].querySelector('select');
                const possui = select.value === 'Sim';

                if (!possui) {
                    if (yPos > doc.internal.pageSize.height - 40) {
                        addFooter();
                        doc.addPage();
                        pageNumber++;
                        yPos = 45;
                        addHeader(pageNumber);
                    }

                    roundedRect(15, yPos, doc.internal.pageSize.width - 30, 12, 2, [250, 250, 250]);
                    doc.setTextColor(...cores.texto);
                    doc.text(`• ${peca}`, 20, yPos + 8);
                    yPos += 15;
                }
            });

            // Adicionar rodapé na última página
            addFooter();

            // Salvar o PDF
            const dataAtual = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
            doc.save(`checklist_${vehicleName}_${dataAtual}.pdf`);
            showToast('PDF gerado com sucesso!');
        };

        logo.onerror = function() {
            console.error('Erro ao carregar a logo');
            showToast('Erro ao carregar a logo, gerando PDF sem logo...');
        };
    }
}


function exportarSelecoes() {
    const vehicleName = document.getElementById('vehicle-name').value || 'Não informado';
    const vehicleYear = document.getElementById('vehicle-year').value || 'Não informado';
    const rows = document.querySelectorAll('#checklist-body tr');

    // Estrutura do JSON para salvar as seleções
    const selecoes = {
        veiculo: {
            nome: vehicleName,
            ano: vehicleYear
        },
        pecas: []
    };

    // Iterar sobre as linhas da tabela para capturar as informações
    rows.forEach(row => {
        const peca = row.cells[0].textContent;
        const select = row.cells[1].querySelector('select');
        const possui = select.value === 'Sim'; // Convertendo para booleano
        const observacao = select.getAttribute('data-observacao') || null;

        selecoes.pecas.push({
            nome: peca,
            possui: possui,
            observacao: possui ? observacao : null // Observação só é válida se "Possui" for true
        });
    });

    // Criação do arquivo JSON
    const blob = new Blob([JSON.stringify(selecoes, null, 2)], { type: 'application/json' });
    const dataAtual = new Date().toISOString().split('T')[0];
    const nomeArquivo = `checklist_pecas_${dataAtual}.json`;

    // Salvar o arquivo
    saveAs(blob, nomeArquivo);
    showToast('Seleções salvas com sucesso!');
}

function importarSelecoes(input) {
    const file = input.files[0];

    if (file) {
        const reader = new FileReader();

        reader.onload = function (e) {
            try {
                const selecoes = JSON.parse(e.target.result);

                // Validação da estrutura do JSON
                if (!selecoes || !selecoes.veiculo || !Array.isArray(selecoes.pecas)) {
                    throw new Error('Formato inválido de arquivo.');
                }

                // Preencher as informações do veículo
                document.getElementById('vehicle-name').value = selecoes.veiculo.nome || 'Não informado';
                document.getElementById('vehicle-year').value = selecoes.veiculo.ano || 'Não informado';

                // Atualizar a tabela de peças
                customPecas = new Set(selecoes.pecas.map(p => p.nome));
                updateChecklistTable();

                // Atualizar os estados das peças na tabela
                const rows = document.querySelectorAll('#checklist-body tr');
                let novoCompletedItems = 0;

                rows.forEach(row => {
                    const peca = row.cells[0].textContent;
                    const select = row.cells[1].querySelector('select');
                    const itemImportado = selecoes.pecas.find(p => p.nome === peca);

                    if (itemImportado) {
                        // Preencher o valor com base no JSON
                        select.value = itemImportado.possui ? 'Sim' : 'Não';

                        if (itemImportado.possui && itemImportado.observacao) {
                            select.setAttribute('data-observacao', itemImportado.observacao);
                        } else {
                            select.removeAttribute('data-observacao');
                        }

                        // Aplicar classes visuais
                        select.classList.remove('status-possui', 'status-nao-possui');
                        select.classList.add(itemImportado.possui ? 'status-possui' : 'status-nao-possui');

                        if (itemImportado.possui) {
                            novoCompletedItems++;
                        }
                    } else {
                        // Para peças que não estão no JSON, marcar como "Não Possui"
                        select.value = 'Não';
                        select.removeAttribute('data-observacao');
                        select.classList.remove('status-possui');
                        select.classList.add('status-nao-possui');
                    }
                });

                completedItems = novoCompletedItems;
                updateProgress();
                showToast('Seleções importadas com sucesso!');
            } catch (error) {
                console.error('Erro ao importar:', error);
                showToast('Erro ao importar arquivo. Verifique o formato.');
            }
            reader.onload = function (e) {
        try {
            // ... existing code ...
            
            updateProgress();
            showToast('Seleções importadas com sucesso!');
            clearUnsavedChanges(); // Add this line
        } catch (error) {
            console.error('Erro ao importar:', error);
            showToast('Erro ao importar arquivo. Verifique o formato.');
        }
    };
        };

        reader.readAsText(file);
    }
}


        

        window.addEventListener('DOMContentLoaded', () => {
            updateChecklistTable();
            const header = document.querySelector('.header');
            const buttons = document.querySelectorAll('button, .button');
            
            header.style.animation = 'fadeIn 0.6s ease-out forwards';
            
            buttons.forEach((button, index) => {
                button.style.animation = 'fadeIn 0.3s ease-out forwards';
                button.style.animationDelay = `${index * 0.1}s`;
            });
        });
        // Scroll button functionality
const scrollTopButton = document.getElementById('scrollTop');
const scrollBottomButton = document.getElementById('scrollBottom');

function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

function scrollToBottom() {
    window.scrollTo({
        top: document.documentElement.scrollHeight,
        behavior: 'smooth'
    });
}

function toggleScrollButton() {
    if (window.pageYOffset > 300) {
        scrollTopButton.classList.add('visible');
    } else {
        scrollTopButton.classList.remove('visible');
    }
}

scrollTopButton.addEventListener('click', scrollToTop);
scrollBottomButton.addEventListener('click', scrollToBottom);
window.addEventListener('scroll', toggleScrollButton);
function gerarRelatorio() {
    const vehicleName = document.getElementById('vehicle-name').value || 'Não informado';
    const vehicleYear = document.getElementById('vehicle-year').value || 'Não informado';
    const rows = document.querySelectorAll('#checklist-body tr');
    const relatorioDiv = document.getElementById('relatorio');
    
    let html = `
        <div class="relatorio-container" style="padding: 2rem;">
            <h2 style="color: var(--text); font-size: 2rem; margin-bottom: 2rem;">Relatório Detalhado do Veículo</h2>
            
            <div class="vehicle-info" style="margin-bottom: 2rem; background: var(--surface); padding: 1.5rem; border-radius: 12px;">
                <h3 style="color: var(--text); font-size: 1.5rem; margin-bottom: 1rem;">Informações do Veículo</h3>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <p style="color: var(--text); margin: 0;">
                        <strong style="color: var(--primary); display: inline-block; min-width: 80px;">Modelo:</strong> ${vehicleName}
                    </p>
                    <p style="color: var(--text); margin: 0;">
                        <strong style="color: var(--primary); display: inline-block; min-width: 80px;">Ano:</strong> ${vehicleYear}
                    </p>
                </div>
            </div>

            <div class="parts-status" style="margin-bottom: 2rem;">
                <h3 style="color: var(--text); font-size: 1.5rem;">Status das Peças</h3>
                <div class="status-grid" style="display: grid; gap: 1rem;">`;

    // Separar peças por status
    const pecasPossuidas = [];
    const pecasNaoPossuidas = [];

    rows.forEach(row => {
        const peca = row.cells[0].textContent;
        const select = row.cells[1].querySelector('select');
        const possui = select.value === 'Sim';
        const observacao = select.getAttribute('data-observacao');
        
        if (possui) {
            pecasPossuidas.push({ peca, observacao });
        } else {
            pecasNaoPossuidas.push({ peca });
        }
    });

    // Seção de peças possuídas
    if (pecasPossuidas.length > 0) {
        html += `
            <div class="possui-section" style="background: var(--surface); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem;">
                <h4 style="color: var(--success); margin-bottom: 1rem;">Peças Disponíveis (${pecasPossuidas.length})</h4>
                <div style="display: grid; gap: 0.5rem;">`;
        
        pecasPossuidas.forEach(({ peca, observacao }) => {
            html += `
                <div style="background: var(--surface-hover); padding: 1rem; border-radius: 8px;">
                    <p style="color: var(--text); margin: 0;">
                        <strong>${peca}</strong>
                    </p>
                    ${observacao ? `<p style="color: var(--text-secondary); margin: 0.5rem 0 0 0; font-size: 0.9rem;">Observação: ${observacao}</p>` : ''}
                </div>`;
        });
        
        html += `</div></div>`;
    }

    // Seção de peças não possuídas
    if (pecasNaoPossuidas.length > 0) {
        html += `
            <div class="nao-possui-section" style="background: var(--surface); padding: 1.5rem; border-radius: 12px;">
                <h4 style="color: #FF3B30; margin-bottom: 1rem;">Peças Indisponíveis (${pecasNaoPossuidas.length})</h4>
                <div style="display: grid; gap: 0.5rem;">`;
        
        pecasNaoPossuidas.forEach(({ peca }) => {
            html += `
                <div style="background: var(--surface-hover); padding: 1rem; border-radius: 8px;">
                    <p style="color: var(--text); margin: 0;">${peca}</p>
                </div>`;
        });
        
        html += `</div></div>`;
    }

    // Estatísticas
    const totalPecas = rows.length;
    const percentualConclusao = ((pecasPossuidas.length / totalPecas) * 100).toFixed(1);

    html += `
            </div>
        </div>
        
        <div class="estatisticas" style="background: var(--surface); padding: 1.5rem; border-radius: 12px; margin-top: 2rem;">
            <h3 style="color: var(--text); font-size: 1.5rem; margin-bottom: 1rem;">Resumo Geral</h3>
            <div style="display: grid; gap: 0.5rem;">
                <p style="color: var(--text); margin: 0;">
                    <strong style="color: var(--primary);">Total de Peças:</strong> ${totalPecas}
                </p>
                <p style="color: var(--text); margin: 0;">
                    <strong style="color: var(--success);">Peças Disponíveis:</strong> ${pecasPossuidas.length}
                </p>
                <p style="color: var(--text); margin: 0;">
                    <strong style="color: #FF3B30;">Peças Indisponíveis:</strong> ${pecasNaoPossuidas.length}
                </p>
                <p style="color: var(--text); margin: 0;">
                    <strong style="color: var(--primary);">Percentual de Conclusão:</strong> ${percentualConclusao}%
                </p>
            </div>
        </div>
    `;

    relatorioDiv.innerHTML = html;
    relatorioDiv.scrollIntoView({ behavior: 'smooth' });
    showToast('Relatório gerado com sucesso!');
}
function searchAndHighlight() {
    const searchInput = document.getElementById('search-checklist');
    const searchTerm = searchInput.value.toLowerCase();
    const rows = document.querySelectorAll('#checklist-body tr');
    const searchResults = document.getElementById('search-results');
    
    // Se o termo de busca estiver vazio (incluindo espaços), mostra todas as linhas
    if (searchTerm.trim().length < 2) {
        rows.forEach(row => {
            row.style.display = ''; // Restaura a exibição padrão
        });
        searchResults.textContent = '';
        return;
    }
    
    let matchCount = 0;
    let firstMatch = null;

    // Procura por correspondências
    rows.forEach(row => {
        const pecaCell = row.cells[0];
        const pecaText = pecaCell.textContent.toLowerCase();
        
        if (pecaText.includes(searchTerm)) {
            row.style.display = ''; // Mostra a linha que corresponde
            matchCount++;
            if (!firstMatch) {
                firstMatch = row;
            }
        } else {
            row.style.display = 'none'; // Esconde a linha que não corresponde
        }
    });
    
    // Atualiza o contador de resultados
    if (matchCount > 0) {
        searchResults.textContent = `${matchCount} ${matchCount === 1 ? 'peça encontrada' : 'peças encontradas'}`;
        // Rola até a primeira correspondência
        if (firstMatch) {
            firstMatch.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        }
    } else {
        searchResults.textContent = 'Nenhuma peça encontrada';
    }
}

// Adiciona um listener para atualizar a pesquisa em tempo real
document.getElementById('search-checklist').addEventListener('input', searchAndHighlight);
// Mantém o listener do Enter também
document.getElementById('search-checklist').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        searchAndHighlight();
    }
});
    </script>
</body>
